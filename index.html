<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Conquerest - Lobby</title>
  
  <!-- Optionally remove integrity if it causes issues -->
  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" 
        integrity="sha256-p4NxAoJBhIIN+hmNHrzRCf9tD/miZyoHS5obTRR9BMY=" 
        crossorigin=""/>
  
  <style>
    /* Reset & Base Styles */
    * { box-sizing: border-box; margin: 0; padding: 0; }
    body {
      background: #111;
      color: #eee;
      font-family: 'Courier New', Courier, monospace;
      line-height: 1.5;
    }
    /* Header */
    header {
      background: #222;
      padding: 20px;
      text-align: center;
      border-bottom: 3px solid #0f0;
    }
    header h1 {
      font-size: 2.5em;
      color: #0f0;
      text-transform: uppercase;
      letter-spacing: 2px;
    }
    /* Navigation */
    nav {
      background: #333;
      display: flex;
      justify-content: center;
      padding: 10px;
      gap: 15px;
    }
    nav button {
      background: #444;
      border: 1px solid #0f0;
      color: #0f0;
      padding: 10px 20px;
      font-size: 1em;
      cursor: pointer;
      text-transform: uppercase;
      letter-spacing: 1px;
      transition: background 0.3s;
    }
    nav button:hover {
      background: #0f0;
      color: #111;
    }
    /* Main Content Layout */
    main {
      display: flex;
      padding: 20px;
      gap: 20px;
    }
    /* Left column: Lobby Cards */
    .lobby-container {
      flex: 2;
    }
    .lobby-card {
      background: #222;
      border: 1px solid #0f0;
      padding: 15px;
      margin-bottom: 15px;
      border-radius: 5px;
    }
    .lobby-card h2 {
      font-size: 1.5em;
      color: #0f0;
      margin-bottom: 10px;
    }
    .lobby-card p {
      margin: 5px 0;
    }
    .lobby-card button {
      background: #444;
      border: 1px solid #0f0;
      padding: 8px 12px;
      color: #0f0;
      cursor: pointer;
      margin-top: 10px;
      text-transform: uppercase;
      transition: background 0.3s;
    }
    .lobby-card button:hover {
      background: #0f0;
      color: #111;
    }
    /* Right column: Sidebar for Player Info & News */
    .sidebar {
      flex: 1;
      background: #222;
      padding: 15px;
      border: 1px solid #0f0;
      border-radius: 5px;
    }
    .sidebar h2 {
      margin-bottom: 10px;
      color: #0f0;
      font-size: 1.5em;
    }
    .stats {
      margin-top: 15px;
    }
    /* Footer */
    footer {
      background: #222;
      text-align: center;
      padding: 15px;
      border-top: 3px solid #0f0;
      margin-top: 20px;
    }
  </style>
</head>
<body>
  <header>
    <h1>Conquerest Lobby</h1>
  </header>
  
  <!-- Navigation Bar -->
  <nav>
    <button onclick="showSection('lobby')">Lobby</button>
    <button onclick="showSection('stats')">Stats</button>
    <button onclick="login()">Login</button>
  </nav>
  
  <!-- Main Content -->
  <main>
    <!-- Left Column: Lobby Cards -->
    <div class="lobby-container">
      <div id="lobby-list">
        <p id="lobby-status" style="color:#f33;">Loading lobbies...</p>
      </div>
    </div>
    <!-- Right Column: Sidebar / Player Info -->
    <div class="sidebar">
      <h2>Player Info</h2>
      <div id="player-stats">
        <p style="color:#ccc;">Not logged in.</p>
      </div>
      <div class="news" style="margin-top:20px;">
        <h2>Latest News</h2>
        <p style="color:#ccc;">Prepare for battle and claim your dominance!</p>
      </div>
    </div>
  </main>
  
  <footer>
    <p>&copy; 2025 Conquerest. All Rights Reserved.</p>
  </footer>
  
  <!-- Scripts -->
  
  <!-- Player System: Authentication & Stats -->
  <script type="module">
    import { loginWithGoogle, renderPlayerStats } from "./player-system.js";
    window.login = async () => {
      try {
        const user = await loginWithGoogle();
        if(user) {
          alert(`Welcome, ${user.displayName}!`);
          renderPlayerStats("player-stats");
        }
      } catch(error) {
        console.error("Login error:", error);
      }
    };
  </script>
  
  <!-- Navigation Helper -->
  <script>
    function showSection(section) {
      // In this layout, sections are always visible (lobby list and sidebar).
      // Optionally, add behavior here if you want to toggle visibility.
      console.log("Switched to section:", section);
    }
  </script>
  
  <!-- Lobbies Logic: Fetch & Display Lobby Cards -->
  <script type="module">
    import { fetchLobbies, joinLobby } from "./lobbies.js";
    
    async function displayLobbies() {
      const lobbyListContainer = document.getElementById("lobby-list");
      const lobbyStatus = document.getElementById("lobby-status");
      lobbyListContainer.innerHTML = "";
      try {
        const lobbies = await fetchLobbies();
        if(lobbies.length === 0) {
          lobbyStatus.textContent = "No lobbies available.";
          return;
        }
        lobbies.forEach(lobby => {
          const card = document.createElement("div");
          card.className = "lobby-card";
          card.innerHTML = `
            <h2>${lobby.lobbyName}</h2>
            <p><strong>Start Time:</strong> ${lobby.startTime}</p>
            <p><strong>In-Game Year:</strong> ${lobby.inGameYear}</p>
            <p><strong>Players:</strong> ${lobby.playersCount}</p>
            <button onclick="window.joinLobby('${lobby.id}')">Join Lobby</button>
          `;
          lobbyListContainer.appendChild(card);
        });
      } catch (error) {
        lobbyStatus.textContent = "Error loading lobbies.";
        console.error("Error in displayLobbies:", error);
      }
    }
    
    window.joinLobby = joinLobby;
    window.addEventListener("load", displayLobbies);
  </script>
</body>
</html>
